{% trans_default_domain 'NIPAProjetBundle' %}
		
{% block body %}
    
    <style>
        #table_texte,#textinput, .textinput{
        text-align:center;
        }       
    </style>
    
    <div class="row col-md-13">
         
        <!-- PANEL -->          
        <div class="panel panel-success">
            <div class="panel-heading">            
                <h3 class="panel-title">Budget actuel: k€ </h3>
                <div class="pull-right">              
                    <span data-toggle="collapse" data-target="#collapseBudget" class="clickable collapsed" title="Afficher détails" data-container="body">
                        <i class="glyphicon glyphicon-plus"></i>
                    </span>
                </div>                
            </div>   
        <div id="collapseBudget" class="panel-collapse collapse">                                
            <div class="panel-body">
                
                <table class="table table-hover" id="champs-table">
                    <thead>
                        <tr>
                            <th class="text-center">ID</th>
                            <th class="text-center">Révisé le</th>
                            <th class="text-center">Montant (en k€)</th>
                            <th class="text-center">Commentaires</th>
                            <th class="text-center">Action</th>     
                        </tr>
                    </thead>
                    <tbody>
                    {% if demande.referenceDemande %}                         
                        {% for budget in listDemandeBudget %}
                            <tr>
                                <td><h5><strong>{{ budget.IPP }}</strong></h5></td>
                                <td><h5>{{ budget.date|date('d/m/Y') }}</h5></td>
                                <td><h5>{{ budget.montant|number_format(2, ',', ' ') }}</h5></td>
                                <td><h5>{{ budget.commentaires }}</h5></td>
                                <td class="text-center"><a href=""  class="btn btn-danger confirmModalLink"><i class="glyphicon glyphicon-remove"></i> </a></td>                    
                            </tr>
                        {% endfor %}   
                    {% endif %}    
                    </tbody>
                </table>
                
            </div> 
        </div>           
            {% if demande.referenceDemande %} 
                <table class="table" id="champs-table-budget-add">
                    <thead>
                        <tr>
                            <th class="text-center">ID</th>
                            <th class="text-center">Révisé le</th>
                            <th class="text-center">Montant (en k€)</th>
                            <th class="text-center">Commentaires</th>
                            <th class="text-center">Action</th>                    
                        </tr>
                    </thead>                   
                    <tbody>
                        <tr>
                            <td>
                                <center>
                                    <select class="form-control" id="IPP" name="IPP">
                                    {% for portefeuille in demande.getPortefeuillesToArray() %}
                                            <option value="{{portefeuille.IPP}}">{{ portefeuille.IPP }}</option>
                                    {% endfor %}
                                    </select>
                                 </center>
                            </td>                             
                             <td>
                                <!-- DatetimePiker --> 
                                <div class="container"> 
                                        <div class='col-sm-12'>
                                            <input type='text' class="form-control input-md date textinput" id='date' name="date" required="true" />
                                        </div>
                                </div>                         
                             </td>
                             <td><input type="number" min="0" step="0.01" data-number-to-fixed="2" data-number-stepfactor="100" id="montant" placeholder="Montant" class="form-control input-md textinput currency" name="montant" required="true"></td>
                             <td><textarea class="form-control input-md" rows="1" id="comment" placeholder="..." name="comment"></textarea></td>                            
                             <td class="text-center"><button type="submit" class="btn btn-success" id="add-budget"><i class="glyphicon glyphicon-check"></i></button></td>
                         </tr>   
                    </tbody>   
                </table>
            {% endif %}
        </div>
    </div>
        
         
    <script>    
    
    $('#date').datetimepicker({
    todayBtn:"true",
    format:"dd/mm/yyyy", 
    autoclose:"true",
    startView:"year",
    minView:"month",
    language:"fr"
    });  


    $('#champs-table-budget-add tr #add-budget').on("click", function()
    {
        var ipp = $("#champs-table-budget-add tr #IPP").val();
        var date = $("#champs-table-budget-add tr #date").val();
        var montant = $("#champs-table-budget-add tr #montant").val();
        var commentaires = $("#champs-table-budget-add tr #comment").val();

        $.ajax({
            type: 'post',
            url: "{% if demande.referenceDemande %}{{ path('demande_update_budget',{'reference': demande.referenceDemande}) }}{% endif %}",
            data: {ipp: ipp, date: date, montant: montant, commentaires: commentaires},
            success: function()
            {     
                //$('#champs-table').DataTable().ajax.reload();
                //var table = $('#champs-table').dataTable();
                //table.fnReloadAjax();
                //$('#champs-table tr:first').after('<tr><td>' + $("#Name").val() + '</td></tr>');
                alert("Ajout effectué avec succès! (TEST)");
                //var url = document.location.toString();
                //if (url.match('#')) {
                //  $('.portfeuille a[href=#'+url.split('#')[1]+']').tab('show') ;
                //} 
                var url = document.location.href;
                $(location).attr('href',url+"#budget");                
                location.reload();
                //var url = $(this).prop('href');
                //event.preventDefault();
                //$('#resultats_ajouter').html(data);
                //$(".loading").hide();
                //document.getElementById('#champs-table').location.reload(true);               
            },
            error: function(e) {
               console.log(e);
             }      
        });       
    });

    </script>
    
{% endblock %}        